---
import Verse from './Verse.astro';
import '@components/VerseOfTheDay.scss';
import AllVerses from 'public/content/verses.json';

export interface Props {
    lang: string;
}

const { lang } = Astro.props; 

const apiKey = "3004a7f40b1726ced351cce69f19da84";
const bibleId = lang == "es" ? "592420522e16049f-01" : "de4e12af7f28f599-02";
const allVerses = AllVerses.verses;

const dayOfYear = date =>
  Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);

const response = await fetch(`https://api.scripture.api.bible/v1/bibles/${bibleId}/search?query=${allVerses[dayOfYear(new Date())]}`, {
        headers: {
            "api-key": "3004a7f40b1726ced351cce69f19da84",
        }
    })

const data = await response.json();

const verse = data["data"]["passages"][0];
---

<div class="verse-of-the-day">
    <Verse 
        book={verse.reference}
        copy={verse.content}
    />
</div>